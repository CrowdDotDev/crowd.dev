TOKEN "top_active_organizations_endpoint_read_6787" READ

NODE top_active_contributors_organization_activity_count
DESCRIPTION >
    Returns activity count by organization

SQL >
    SELECT organizationId, COUNT(id) AS activityCount
    FROM activities_with_relations_sorted_deduplicated_ds
    WHERE
        timestamp >= (now() - INTERVAL 10 YEAR)
        AND timestamp < now()
        AND organizationId != ''
        AND isContribution
    GROUP BY organizationId
    ORDER BY activityCount DESC

NODE top_active_organizations_organizations_deduplicated
DESCRIPTION >
    Returns necessary columns from organizations

SQL >
    SELECT id, displayName, logo FROM organizations FINAL

NODE top_active_organizations_results
DESCRIPTION >
    Map everything together

SQL >
    %
    SELECT id, displayName, logo, activityCount
    FROM top_active_contributors_organization_activity_count
    JOIN
        top_active_organizations_organizations_deduplicated
        ON top_active_organizations_organizations_deduplicated.id
        = top_active_contributors_organization_activity_count.organizationId
    GROUP BY id, displayName, logo, activityCount
    ORDER BY activityCount DESC
    LIMIT {{ Int32(pageSize, 10) }}
    OFFSET {{ Int32(page, 0) * Int32(pageSize, 10) }}
